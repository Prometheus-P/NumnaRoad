{
  "id": "orders",
  "name": "orders",
  "type": "base",
  "system": false,
  "schema": [
    {
      "id": "order_id",
      "name": "order_id",
      "type": "text",
      "required": true,
      "unique": true,
      "options": {}
    },
    {
      "id": "sales_channel",
      "name": "sales_channel",
      "type": "select",
      "required": true,
      "options": {
        "maxSelect": 1,
        "values": ["stripe", "smartstore", "tosspay", "direct"]
      }
    },
    {
      "id": "external_order_id",
      "name": "external_order_id",
      "type": "text",
      "required": false,
      "options": {}
    },
    {
      "id": "smartstore_product_order_id",
      "name": "smartstore_product_order_id",
      "type": "text",
      "required": false,
      "unique": false,
      "options": {}
    },
    {
      "id": "user",
      "name": "user",
      "type": "relation",
      "required": false,
      "options": {
        "collectionId": "_pb_users_auth_",
        "cascadeDelete": false,
        "minSelect": null,
        "maxSelect": 1,
        "displayFields": []
      }
    },
    {
      "id": "product",
      "name": "product",
      "type": "relation",
      "required": true,
      "options": {
        "collectionId": "esim_products",
        "cascadeDelete": false,
        "minSelect": null,
        "maxSelect": 1,
        "displayFields": []
      }
    },
    {
      "id": "status",
      "name": "status",
      "type": "select",
      "required": true,
      "options": {
        "maxSelect": 1,
        "values": [
          "pending",
          "processing",
          "completed",
          "failed",
          "refunded",
          "payment_received",
          "fulfillment_started",
          "provider_confirmed",
          "email_sent",
          "delivered",
          "provider_failed",
          "refund_needed"
        ]
      }
    },
    {
      "id": "payment_status",
      "name": "payment_status",
      "type": "select",
      "required": true,
      "options": {
        "maxSelect": 1,
        "values": ["pending", "paid", "failed", "refunded"]
      }
    },
    {
      "id": "payment_method",
      "name": "payment_method",
      "type": "select",
      "required": true,
      "options": {
        "maxSelect": 1,
        "values": ["card", "paypal", "bank_transfer", "kakaopay", "smartstore", "tosspay"]
      }
    },
    {
      "id": "payment_id",
      "name": "payment_id",
      "type": "text",
      "required": false,
      "options": {}
    },
    {
      "id": "stripe_payment_intent",
      "name": "stripe_payment_intent",
      "type": "text",
      "required": true,
      "unique": true,
      "options": {}
    },
    {
      "id": "amount",
      "name": "amount",
      "type": "number",
      "required": true,
      "options": {
        "min": 0,
        "max": null
      }
    },
    {
      "id": "currency",
      "name": "currency",
      "type": "text",
      "required": true,
      "options": {}
    },
    {
      "id": "esim_qr_code",
      "name": "esim_qr_code",
      "type": "text",
      "required": false,
      "options": {}
    },
    {
      "id": "esim_qr_code_url",
      "name": "esim_qr_code_url",
      "type": "url",
      "required": false,
      "options": {}
    },
    {
      "id": "esim_activation_code",
      "name": "esim_activation_code",
      "type": "text",
      "required": false,
      "options": {}
    },
    {
      "id": "esim_iccid",
      "name": "esim_iccid",
      "type": "text",
      "required": false,
      "options": {}
    },
    {
      "id": "customer_email",
      "name": "customer_email",
      "type": "text",
      "required": true,
      "options": {}
    },
    {
      "id": "customer_name",
      "name": "customer_name",
      "type": "text",
      "required": false,
      "options": {}
    },
    {
      "id": "customer_phone",
      "name": "customer_phone",
      "type": "text",
      "required": false,
      "options": {}
    },
    {
      "id": "completed_at",
      "name": "completed_at",
      "type": "date",
      "required": false,
      "options": {}
    },
    {
      "id": "email_sent_at",
      "name": "email_sent_at",
      "type": "date",
      "required": false,
      "options": {}
    },
    {
      "id": "error_message",
      "name": "error_message",
      "type": "text",
      "required": false,
      "options": {}
    },
    {
      "id": "retry_count",
      "name": "retry_count",
      "type": "number",
      "required": true,
      "options": {
        "min": 0,
        "max": null
      }
    },
    {
      "id": "provider_used",
      "name": "provider_used",
      "type": "text",
      "required": false,
      "options": {}
    },
    {
      "id": "dispatch_method",
      "name": "dispatch_method",
      "type": "select",
      "required": true,
      "options": {
        "maxSelect": 1,
        "values": ["provider_api", "google_sheets"]
      }
    },
    {
      "id": "correlation_id",
      "name": "correlation_id",
      "type": "text",
      "required": false,
      "options": {}
    },
    {
      "id": "stripe_session_id",
      "name": "stripe_session_id",
      "type": "text",
      "required": false,
      "options": {}
    },
    {
      "id": "fulfillment_started_at",
      "name": "fulfillment_started_at",
      "type": "date",
      "required": false,
      "options": {}
    },
    {
      "id": "provider_order_id",
      "name": "provider_order_id",
      "type": "text",
      "required": false,
      "options": {}
    }
  ],
  "indexes": [
    "CREATE INDEX idx_order_id ON orders (order_id)",
    "CREATE INDEX idx_status ON orders (status)",
    "CREATE INDEX idx_payment_status ON orders (payment_status)",
    "CREATE INDEX idx_customer_email ON orders (customer_email)",
    "CREATE INDEX idx_correlation_id ON orders (correlation_id)",
    "CREATE INDEX idx_sales_channel ON orders (sales_channel)",
    "CREATE UNIQUE INDEX idx_order_id_unique ON orders (order_id)",
    "CREATE UNIQUE INDEX idx_stripe_payment_intent ON orders (stripe_payment_intent)",
    "CREATE UNIQUE INDEX idx_smartstore_order ON orders (smartstore_product_order_id) WHERE smartstore_product_order_id IS NOT NULL"
  ],
  "listRule": "@request.auth.id = user.id",
  "viewRule": "@request.auth.id = user.id",
  "createRule": "",
  "updateRule": null,
  "deleteRule": null
}